FROM node:alpine

ARG SERVICE_ACCOUNT_KEY
ARG JWT_SECRET
ARG NEXT_PUBLIC_BASE_URL
ARG NEXTAUTH_SECRET
ARG NEXTAUTH_URL
ARG API_KEY
ARG NODE_ENV
ARG NEXTAUTH_PUBLIC_URL
ARG NEXT_PUBLIC_URL
ARG GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET

ENV SERVICE_ACCOUNT_KEY_ENV=$SERVICE_ACCOUNT_KEY
ENV JWT_SECRET=$JWT_SECRET
ENV NEXT_PUBLIC_BASE_URL_ENV=$NEXT_PUBLIC_BASE_URL
ENV NEXTAUTH_SECRET=$NEXTAUTH_SECRET
ENV NEXTAUTH_URL=$NEXTAUTH_URL
ENV API_KEY=$API_KEY
ENV NODE_ENV=$NODE_ENV
ENV NEXTAUTH_PUBLIC_URL=$NEXTAUTH_PUBLIC_URL
ENV NEXT_PUBLIC_URL=$NEXT_PUBLIC_URL
ENV GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID
ENV GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET

RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

COPY . /usr/src/app/

RUN npm install
RUN npm run build

CMD ["npm", "start"]